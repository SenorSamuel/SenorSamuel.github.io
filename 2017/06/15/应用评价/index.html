<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="Samuel blog" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="应用评价summary12345678910if (!产品经理遵守review GuideLines) &amp;#123;    //Do whatever he want&amp;#125;else &amp;#123;    if (iOSVersion &amp;gt;= 10.3) &amp;#123;        //使用SKStoreReviewController的requestReview方法    &amp;#125;el">
<meta property="og:type" content="article">
<meta property="og:title" content="应用评价">
<meta property="og:url" content="http://yoursite.com/2017/06/15/应用评价/index.html">
<meta property="og:site_name" content="Samuel blog">
<meta property="og:description" content="应用评价summary12345678910if (!产品经理遵守review GuideLines) &amp;#123;    //Do whatever he want&amp;#125;else &amp;#123;    if (iOSVersion &amp;gt;= 10.3) &amp;#123;        //使用SKStoreReviewController的requestReview方法    &amp;#125;el">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20170619174141.png?imageView2/2/w/480/h/360/q/99|imageslim">
<meta property="og:image" content="http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20170619221921.png?imageView2/2/w/360/h/200/q/99|imageslim">
<meta property="og:updated_time" content="2017-07-19T12:49:37.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="应用评价">
<meta name="twitter:description" content="应用评价summary12345678910if (!产品经理遵守review GuideLines) &amp;#123;    //Do whatever he want&amp;#125;else &amp;#123;    if (iOSVersion &amp;gt;= 10.3) &amp;#123;        //使用SKStoreReviewController的requestReview方法    &amp;#125;el">
<meta name="twitter:image" content="http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20170619174141.png?imageView2/2/w/480/h/360/q/99|imageslim">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2017/06/15/应用评价/"/>





  <title>应用评价 | Samuel blog</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Samuel blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">SamuelChan</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/06/15/应用评价/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="SamuelChan">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20170719163750.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Samuel blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">应用评价</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-15T21:25:52+08:00">
                2017-06-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2017/06/15/应用评价/" class="leancloud_visitors" data-flag-title="应用评价">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数 </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="应用评价"><a href="#应用评价" class="headerlink" title="应用评价"></a>应用评价</h2><h3 id="summary"><a href="#summary" class="headerlink" title="summary"></a>summary</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">if (!产品经理遵守review GuideLines) &#123;</div><div class="line">    //Do whatever he want</div><div class="line">&#125;else &#123;</div><div class="line">    if (iOSVersion &gt;= 10.3) &#123;</div><div class="line">        //使用SKStoreReviewController的requestReview方法</div><div class="line">    &#125;else &#123;</div><div class="line">        //1.怎么展示:openUrl SKStoreProductViewController</div><div class="line">        //2.什么时候展示: iRate,服务器控制</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h3><ol>
<li>每个应用在App store上面都会有用户的评价和评分  </li>
<li>评价和评分越高的应用将会被优先展示,排名提高.所以才有那么多人刷榜,尤其是游戏,但是从iOS11开始的App store将只会展示每个分类下前三个应用  </li>
<li>在2017.6苹果更新了Review GuideLines,强制要求开发者使用iOS 10.3引入的api:<code>SKStoreReviewController的requestReview方法</code>, 也就是说iOS 10.3之后的版本弹出的框应用使用这个api,一旦发现会被拒绝,<strong>可是很明显审核的时候是很难发现的</strong>.</li>
</ol>
<blockquote>
<p>1.1.7 App Store Reviews:<br>  App Store customer reviews can be an integral part of the app experience, so you should treat customers with respect when responding to their comments. Keep your responses targeted to the user’s comments and do not include personal information, spam, or marketing in your response.<br>Use the provided API to prompt users to review your app; this functionality allows customers to provide an App Store rating and review without the inconvenience of leaving your app, and we will disallow custom review prompts.</p>
</blockquote>
<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><h4 id="iOS-10-3之前实现应用内评价的方法"><a href="#iOS-10-3之前实现应用内评价的方法" class="headerlink" title="iOS 10.3之前实现应用内评价的方法"></a><code>iOS 10.3之前</code>实现应用内评价的方法</h4><p>怎么展示:  </p>
<ol>
<li>现在应用最多的做法:弹出一个UIAlertView,三个button,但是其中两个都是会跳到app store的  </li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">	UIAlertView *alertView = [[UIAlertView alloc] initWithTitle:@&quot;程序猿奋力出新版&quot; message:@&quot;打滚儿求好评&quot; delegate:self cancelButtonTitle:@&quot;残忍拒绝&quot; otherButtonTitles:@&quot;好评(跳App store)&quot;,@&quot;吐槽(跳App store)&quot;,nil];</div><div class="line">	[alertView show];</div><div class="line"></div><div class="line">//在UIAlertViewDelegate中</div><div class="line">//支持直接跳转到AppStore的评论编辑页:通过在项目 URL 查询参数的最后加上 action=write-review 就可以跳转到 AppStore 并自动模态打开评论编辑页面。在此之前我们只能跳转到评论页。</div><div class="line">	NSURL *url = [NSURL URLWithString:@&quot;http://itunes.apple.com/WebObjects/MZStore.woa/wa/viewContentsUserReviews?id=1014844521&amp;pageNumber=0&amp;sortOrdering=2&amp;type=Purple+Software&amp;mt=8&amp;action=write-review&quot;];</div><div class="line">	if([[UIApplication sharedApplication] canOpenURL:url])&#123;</div><div class="line">        [[UIApplication sharedApplication] openURL:url];</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<p>2.在页面中Modal出一个SKStoreProductViewController,用户在应用即可完成评分和评论  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">#import &lt;StoreKit/StoreKit.h&gt;</div><div class="line"></div><div class="line">    SKStoreProductViewController *storeProductVC = [[SKStoreProductViewController alloc]init];</div><div class="line">    storeProductVC.delegate = self;</div><div class="line"></div><div class="line">    [storeProductVC loadProductWithParameters:@&#123;SKStoreProductParameterITunesItemIdentifier:@&quot;1014844521&quot;&#125; completionBlock:^(BOOL result, NSError * _Nullable error) &#123;</div><div class="line"></div><div class="line">        if (error) &#123;</div><div class="line">            NSLog(@&quot;%@&quot;,[error localizedDescription]);</div><div class="line">        &#125; else &#123;</div><div class="line">            NSLog(@&quot;加载完成&quot;);</div><div class="line">            [self presentViewController:storeProductVC animated:YES completion:^&#123;</div><div class="line">                NSLog(@&quot;界面弹出完成&quot;);</div><div class="line">            &#125;];</div><div class="line">        &#125;</div><div class="line">    &#125;];</div><div class="line"></div><div class="line">    //modal出来的页面点击&quot;取消&quot;的回调</div><div class="line">	- (void)productViewControllerDidFinish:(SKStoreProductViewController *)viewController&#123;</div><div class="line">    [self dismissViewControllerAnimated:YES completion:nil];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>什么时候展示:<br>1.<a href="https://github.com/nicklockwood/iRate" target="_blank" rel="external">iRate</a>:提供了丰富的自定义弹出规则,之前我就是使用这个来做</p>
<p>2.服务器来控制弹出的时机</p>
<h4 id="iOS-10-3之后实现应用内评价的方法"><a href="#iOS-10-3之后实现应用内评价的方法" class="headerlink" title="iOS 10.3之后实现应用内评价的方法"></a><code>iOS 10.3之后</code>实现应用内评价的方法</h4><p><a href="https://developer.apple.com/app-store/ratings-and-reviews/" target="_blank" rel="external">官方文档看这里</a>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[SKStoreReviewController requestReview];</div></pre></td></tr></table></figure>
<p><img src="http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20170619174141.png?imageView2/2/w/480/h/360/q/99|imageslim" alt="SamuelChan/20170619174141.png"></p>
<p>Feature:  </p>
<ol>
<li>只有评分,没有评论  </li>
<li>弹出完全由苹果控制,所以不能在手势/按钮点击回调中使用这个api,你并不知道有没有弹出  </li>
<li>每年只会弹出三次  </li>
<li>只会在最新版本中弹出,低版本调用了这个api也不会弹出  </li>
<li>在debug环境下,该框会一直弹出,TestFlight该方法无效</li>
<li>关闭:如下图<br><img src="http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20170619221921.png?imageView2/2/w/360/h/200/q/99|imageslim" alt="SamuelChan/20170619221921.png"></li>
</ol>
<h3 id="我的方案"><a href="#我的方案" class="headerlink" title="我的方案"></a>我的方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"> if ([UIDevice currentDevice].systemVersion.floatValue &gt;= 10.3) &#123;</div><div class="line">     [self inAppSKStoreReviewController];   </div><div class="line">  &#125;else&#123;</div><div class="line">//自定义弹出规则比如iRate,</div><div class="line">[[iRate shareInstance] logEvent:NO]</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><ol>
<li>我从来都没有被弹出框引导去评价,都是直接关掉的;可以有了10.3的api又有多少产品经理会遵守呢…</li>
<li>这篇文章make no sense,只是用来练手的 哈哈</li>
</ol>
<h3 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h3><p><a href="https://sspai.com/post/38673" target="_blank" rel="external">具透丨iOS 10.3 新 App Store 评价机制详解</a><br><a href="https://9to5mac.com/2017/06/09/app-rating-custom-prompts-app-store-banned/" target="_blank" rel="external">App Store now requires developers to use official API to request app ratings, disallows custom prompts</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/06/30/禅与Objective-C编程艺术/" rel="prev" title="禅与Objective-C编程艺术读书笔记">
                禅与Objective-C编程艺术读书笔记 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://ormqbgzmy.bkt.clouddn.com/SamuelChan/20170719163750.png"
               alt="SamuelChan" />
          <p class="site-author-name" itemprop="name">SamuelChan</p>
           
              <p class="site-description motion-element" itemprop="description">Good Luck Have fun!</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">3</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#应用评价"><span class="nav-number">1.</span> <span class="nav-text">应用评价</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#summary"><span class="nav-number">1.1.</span> <span class="nav-text">summary</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关于"><span class="nav-number">1.2.</span> <span class="nav-text">关于</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现"><span class="nav-number">1.3.</span> <span class="nav-text">实现</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#iOS-10-3之前实现应用内评价的方法"><span class="nav-number">1.3.1.</span> <span class="nav-text">iOS 10.3之前实现应用内评价的方法</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#iOS-10-3之后实现应用内评价的方法"><span class="nav-number">1.3.2.</span> <span class="nav-text">iOS 10.3之后实现应用内评价的方法</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#我的方案"><span class="nav-number">1.4.</span> <span class="nav-text">我的方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">1.5.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#参考文章"><span class="nav-number">1.6.</span> <span class="nav-text">参考文章</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">SamuelChan</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  






  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("5DXEtyIfD1Td3xo3s9t77pe0-gzGzoHsz", "adHDX8YCoxhJyNPBn4h7WQed");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
